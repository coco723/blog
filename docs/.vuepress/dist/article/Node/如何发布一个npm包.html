<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何发布一个npm包 | 郭雁宏的博客</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="知识图谱">
    
    <link rel="preload" href="/docs/assets/css/0.styles.52bb2005.css" as="style"><link rel="preload" href="/docs/assets/js/app.46096340.js" as="script"><link rel="preload" href="/docs/assets/js/2.7017696c.js" as="script"><link rel="preload" href="/docs/assets/js/94.c1380c2b.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.dbbc947c.js"><link rel="prefetch" href="/docs/assets/js/100.85c7452d.js"><link rel="prefetch" href="/docs/assets/js/101.c2063a1b.js"><link rel="prefetch" href="/docs/assets/js/102.819c5117.js"><link rel="prefetch" href="/docs/assets/js/103.0030f22f.js"><link rel="prefetch" href="/docs/assets/js/104.d7c639f3.js"><link rel="prefetch" href="/docs/assets/js/105.4f558cf9.js"><link rel="prefetch" href="/docs/assets/js/106.e1b30be1.js"><link rel="prefetch" href="/docs/assets/js/107.e88e4a4c.js"><link rel="prefetch" href="/docs/assets/js/108.39f6f2da.js"><link rel="prefetch" href="/docs/assets/js/109.421ccf9d.js"><link rel="prefetch" href="/docs/assets/js/11.f475b59e.js"><link rel="prefetch" href="/docs/assets/js/110.20576769.js"><link rel="prefetch" href="/docs/assets/js/111.f5fdeb8e.js"><link rel="prefetch" href="/docs/assets/js/112.01c5f4a0.js"><link rel="prefetch" href="/docs/assets/js/113.57950ad2.js"><link rel="prefetch" href="/docs/assets/js/114.5149d808.js"><link rel="prefetch" href="/docs/assets/js/115.fdb097fd.js"><link rel="prefetch" href="/docs/assets/js/116.1c682600.js"><link rel="prefetch" href="/docs/assets/js/117.ed7f34b2.js"><link rel="prefetch" href="/docs/assets/js/118.35c1b941.js"><link rel="prefetch" href="/docs/assets/js/119.8f82bac2.js"><link rel="prefetch" href="/docs/assets/js/12.38933efd.js"><link rel="prefetch" href="/docs/assets/js/120.4341d53d.js"><link rel="prefetch" href="/docs/assets/js/121.0a51577b.js"><link rel="prefetch" href="/docs/assets/js/122.9095cb82.js"><link rel="prefetch" href="/docs/assets/js/123.32a1846a.js"><link rel="prefetch" href="/docs/assets/js/124.1d6e8d90.js"><link rel="prefetch" href="/docs/assets/js/125.0a9221ef.js"><link rel="prefetch" href="/docs/assets/js/126.616d92eb.js"><link rel="prefetch" href="/docs/assets/js/127.b9f40bbd.js"><link rel="prefetch" href="/docs/assets/js/128.46b26f81.js"><link rel="prefetch" href="/docs/assets/js/129.8a582252.js"><link rel="prefetch" href="/docs/assets/js/13.d64b74f4.js"><link rel="prefetch" href="/docs/assets/js/130.a161bd2a.js"><link rel="prefetch" href="/docs/assets/js/131.95611183.js"><link rel="prefetch" href="/docs/assets/js/132.11d2c38c.js"><link rel="prefetch" href="/docs/assets/js/133.e315fef0.js"><link rel="prefetch" href="/docs/assets/js/134.c9ee12d4.js"><link rel="prefetch" href="/docs/assets/js/135.9566dd86.js"><link rel="prefetch" href="/docs/assets/js/136.6bff8f44.js"><link rel="prefetch" href="/docs/assets/js/137.727cf25d.js"><link rel="prefetch" href="/docs/assets/js/138.6d2a30dd.js"><link rel="prefetch" href="/docs/assets/js/139.c2ccd69b.js"><link rel="prefetch" href="/docs/assets/js/14.f0522247.js"><link rel="prefetch" href="/docs/assets/js/140.6eebddfa.js"><link rel="prefetch" href="/docs/assets/js/141.2535a739.js"><link rel="prefetch" href="/docs/assets/js/142.f775ff2b.js"><link rel="prefetch" href="/docs/assets/js/143.47dd4afd.js"><link rel="prefetch" href="/docs/assets/js/144.56941f2f.js"><link rel="prefetch" href="/docs/assets/js/145.f765e124.js"><link rel="prefetch" href="/docs/assets/js/146.08f4f3f2.js"><link rel="prefetch" href="/docs/assets/js/147.9db366f6.js"><link rel="prefetch" href="/docs/assets/js/148.65d1fe38.js"><link rel="prefetch" href="/docs/assets/js/149.963be581.js"><link rel="prefetch" href="/docs/assets/js/15.fbe7f364.js"><link rel="prefetch" href="/docs/assets/js/150.f924935e.js"><link rel="prefetch" href="/docs/assets/js/151.df82fcc0.js"><link rel="prefetch" href="/docs/assets/js/152.46981be1.js"><link rel="prefetch" href="/docs/assets/js/153.14bb11fd.js"><link rel="prefetch" href="/docs/assets/js/154.2b42cade.js"><link rel="prefetch" href="/docs/assets/js/155.72fe9e02.js"><link rel="prefetch" href="/docs/assets/js/156.69d339d7.js"><link rel="prefetch" href="/docs/assets/js/157.4ab6dfa2.js"><link rel="prefetch" href="/docs/assets/js/158.4ffabe12.js"><link rel="prefetch" href="/docs/assets/js/159.c6a45bb7.js"><link rel="prefetch" href="/docs/assets/js/16.9762142f.js"><link rel="prefetch" href="/docs/assets/js/17.6696a62b.js"><link rel="prefetch" href="/docs/assets/js/18.09a87b77.js"><link rel="prefetch" href="/docs/assets/js/19.9b32d69f.js"><link rel="prefetch" href="/docs/assets/js/20.c5901120.js"><link rel="prefetch" href="/docs/assets/js/21.4ae99416.js"><link rel="prefetch" href="/docs/assets/js/22.c9c67f4d.js"><link rel="prefetch" href="/docs/assets/js/23.517904e6.js"><link rel="prefetch" href="/docs/assets/js/24.4abfd6b6.js"><link rel="prefetch" href="/docs/assets/js/25.f8221fc9.js"><link rel="prefetch" href="/docs/assets/js/26.4637fa77.js"><link rel="prefetch" href="/docs/assets/js/27.18691036.js"><link rel="prefetch" href="/docs/assets/js/28.ede261f3.js"><link rel="prefetch" href="/docs/assets/js/29.2b522d75.js"><link rel="prefetch" href="/docs/assets/js/3.9ed1609e.js"><link rel="prefetch" href="/docs/assets/js/30.5e30924d.js"><link rel="prefetch" href="/docs/assets/js/31.7f7dcee0.js"><link rel="prefetch" href="/docs/assets/js/32.3fd4d3f3.js"><link rel="prefetch" href="/docs/assets/js/33.348b5383.js"><link rel="prefetch" href="/docs/assets/js/34.bd05befb.js"><link rel="prefetch" href="/docs/assets/js/35.6f39c642.js"><link rel="prefetch" href="/docs/assets/js/36.d216d3e1.js"><link rel="prefetch" href="/docs/assets/js/37.2ff58b43.js"><link rel="prefetch" href="/docs/assets/js/38.f564b448.js"><link rel="prefetch" href="/docs/assets/js/39.8faa5e99.js"><link rel="prefetch" href="/docs/assets/js/4.2b93dc1f.js"><link rel="prefetch" href="/docs/assets/js/40.30e1b071.js"><link rel="prefetch" href="/docs/assets/js/41.e82eb255.js"><link rel="prefetch" href="/docs/assets/js/42.a7b82a37.js"><link rel="prefetch" href="/docs/assets/js/43.9cef951e.js"><link rel="prefetch" href="/docs/assets/js/44.eeeaf9e9.js"><link rel="prefetch" href="/docs/assets/js/45.1322fea0.js"><link rel="prefetch" href="/docs/assets/js/46.0992a205.js"><link rel="prefetch" href="/docs/assets/js/47.a382f1e0.js"><link rel="prefetch" href="/docs/assets/js/48.d80a7efc.js"><link rel="prefetch" href="/docs/assets/js/49.8d4c5ed1.js"><link rel="prefetch" href="/docs/assets/js/5.f064699d.js"><link rel="prefetch" href="/docs/assets/js/50.f0522c10.js"><link rel="prefetch" href="/docs/assets/js/51.4aa9c6bd.js"><link rel="prefetch" href="/docs/assets/js/52.3f68356a.js"><link rel="prefetch" href="/docs/assets/js/53.f415b2c1.js"><link rel="prefetch" href="/docs/assets/js/54.1931bbb5.js"><link rel="prefetch" href="/docs/assets/js/55.43517470.js"><link rel="prefetch" href="/docs/assets/js/56.ae930669.js"><link rel="prefetch" href="/docs/assets/js/57.04ffb3d5.js"><link rel="prefetch" href="/docs/assets/js/58.460ce6ad.js"><link rel="prefetch" href="/docs/assets/js/59.3ed2fbef.js"><link rel="prefetch" href="/docs/assets/js/6.258c7694.js"><link rel="prefetch" href="/docs/assets/js/60.45ef3095.js"><link rel="prefetch" href="/docs/assets/js/61.5d271aa8.js"><link rel="prefetch" href="/docs/assets/js/62.be566daa.js"><link rel="prefetch" href="/docs/assets/js/63.6764ecb6.js"><link rel="prefetch" href="/docs/assets/js/64.3db7d9e5.js"><link rel="prefetch" href="/docs/assets/js/65.bfb17c63.js"><link rel="prefetch" href="/docs/assets/js/66.85d780bc.js"><link rel="prefetch" href="/docs/assets/js/67.6e4bc734.js"><link rel="prefetch" href="/docs/assets/js/68.553f2c6e.js"><link rel="prefetch" href="/docs/assets/js/69.336be914.js"><link rel="prefetch" href="/docs/assets/js/7.73b19b4c.js"><link rel="prefetch" href="/docs/assets/js/70.a296a9bb.js"><link rel="prefetch" href="/docs/assets/js/71.dcc73705.js"><link rel="prefetch" href="/docs/assets/js/72.b30d5ec9.js"><link rel="prefetch" href="/docs/assets/js/73.dde14de0.js"><link rel="prefetch" href="/docs/assets/js/74.2772e9df.js"><link rel="prefetch" href="/docs/assets/js/75.047e7004.js"><link rel="prefetch" href="/docs/assets/js/76.54bab402.js"><link rel="prefetch" href="/docs/assets/js/77.0cfabe27.js"><link rel="prefetch" href="/docs/assets/js/78.69d8ae90.js"><link rel="prefetch" href="/docs/assets/js/79.f500a9dd.js"><link rel="prefetch" href="/docs/assets/js/8.64bd9638.js"><link rel="prefetch" href="/docs/assets/js/80.08ed4a3e.js"><link rel="prefetch" href="/docs/assets/js/81.ac8806a5.js"><link rel="prefetch" href="/docs/assets/js/82.68e6c394.js"><link rel="prefetch" href="/docs/assets/js/83.a6fa7b54.js"><link rel="prefetch" href="/docs/assets/js/84.5cc47b42.js"><link rel="prefetch" href="/docs/assets/js/85.8110173f.js"><link rel="prefetch" href="/docs/assets/js/86.17919b3c.js"><link rel="prefetch" href="/docs/assets/js/87.ad085900.js"><link rel="prefetch" href="/docs/assets/js/88.eb125c41.js"><link rel="prefetch" href="/docs/assets/js/89.9dd68713.js"><link rel="prefetch" href="/docs/assets/js/9.0d5c9d6d.js"><link rel="prefetch" href="/docs/assets/js/90.4cf11604.js"><link rel="prefetch" href="/docs/assets/js/91.0165eb82.js"><link rel="prefetch" href="/docs/assets/js/92.903fec46.js"><link rel="prefetch" href="/docs/assets/js/93.c29b471b.js"><link rel="prefetch" href="/docs/assets/js/95.a04cdc1a.js"><link rel="prefetch" href="/docs/assets/js/96.1898e4c4.js"><link rel="prefetch" href="/docs/assets/js/97.8856ca32.js"><link rel="prefetch" href="/docs/assets/js/98.5ce0acee.js"><link rel="prefetch" href="/docs/assets/js/99.4ad355d7.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.52bb2005.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">郭雁宏的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/article/" class="nav-link router-link-active">
  文章目录
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="https://github.com/coco723/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/article/" class="nav-link router-link-active">
  文章目录
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="https://github.com/coco723/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/article/" aria-current="page" class="sidebar-link">文章目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>图表</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器和网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>样式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Node实践</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/article/Node/6个Async优于Promise的方面.html" class="sidebar-link">6个Async、Await优于Promise的方面</a></li><li><a href="/docs/article/Node/脚手架之egg-init.html" class="sidebar-link">脚手架之egg-init</a></li><li><a href="/docs/article/Node/结合源码揭秘egg运行原理.html" class="sidebar-link">结合源码揭秘egg运行原理</a></li><li><a href="/docs/article/Node/如何保存价值上千万的Node源代码.html" class="sidebar-link">如何保存价值上千万的Node源代码</a></li><li><a href="/docs/article/Node/如何发布一个npm包.html" class="active sidebar-link">如何发布一个npm包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/article/Node/如何发布一个npm包.html#pixiv-login" class="sidebar-link">pixiv-login</a></li><li class="sidebar-sub-header"><a href="/docs/article/Node/如何发布一个npm包.html#开发工具" class="sidebar-link">开发工具</a></li><li class="sidebar-sub-header"><a href="/docs/article/Node/如何发布一个npm包.html#初始化项目" class="sidebar-link">初始化项目</a></li><li class="sidebar-sub-header"><a href="/docs/article/Node/如何发布一个npm包.html#安装依赖" class="sidebar-link">安装依赖</a></li><li class="sidebar-sub-header"><a href="/docs/article/Node/如何发布一个npm包.html#readme-md" class="sidebar-link">README.md</a></li><li class="sidebar-sub-header"><a href="/docs/article/Node/如何发布一个npm包.html#gitignore" class="sidebar-link">.gitignore</a></li><li class="sidebar-sub-header"><a href="/docs/article/Node/如何发布一个npm包.html#npm-version" class="sidebar-link">npm version</a></li><li class="sidebar-sub-header"><a href="/docs/article/Node/如何发布一个npm包.html#npm-publish" class="sidebar-link">npm publish</a></li><li class="sidebar-sub-header"><a href="/docs/article/Node/如何发布一个npm包.html#npm-deprecate" class="sidebar-link">npm deprecate</a></li></ul></li><li><a href="/docs/article/Node/如何解决npm-unmet-peer-dependency.html" class="sidebar-link">如何解决 npm unmet peer dependency</a></li><li><a href="/docs/article/Node/项目开发中的规范.html" class="sidebar-link">项目开发中的规范</a></li><li><a href="/docs/article/Node/怎么开发一个像egg-init的脚手架.html" class="sidebar-link">怎么开发一个像egg-init的脚手架</a></li><li><a href="/docs/article/Node/clinic快速定位性能问题.html" class="sidebar-link">使用node-clinic快速定位性能问题</a></li><li><a href="/docs/article/Node/cluster扩展你的node应用.html" class="sidebar-link">cluster：扩展你的node应用</a></li><li><a href="/docs/article/Node/egg-bin源码解析笔记.html" class="sidebar-link">egg-bin源码解析笔记</a></li><li><a href="/docs/article/Node/egg常见问题笔记.html" class="sidebar-link">egg常见问题笔记</a></li><li><a href="/docs/article/Node/egg的Controller最佳实践.html" class="sidebar-link">egg 的 Controller 最佳实践</a></li><li><a href="/docs/article/Node/egg的HTTP请求.html" class="sidebar-link">egg的HTTP请求</a></li><li><a href="/docs/article/Node/egg基于egg-validate的定制化升级.html" class="sidebar-link">egg基于egg-validate的定制化升级</a></li><li><a href="/docs/article/Node/egg框架框架nest框架对比.html" class="sidebar-link">egg框架与nest框架的对比</a></li><li><a href="/docs/article/Node/egg框架中的参数校验.html" class="sidebar-link">egg框架中的参数校验</a></li><li><a href="/docs/article/Node/egg体系.html" class="sidebar-link">egg体系</a></li><li><a href="/docs/article/Node/egg应用自定义4XX和5XX的方案.html" class="sidebar-link">egg应用自定义4XX和5XX的方案</a></li><li><a href="/docs/article/Node/egg中cookie与Session的使用笔记.html" class="sidebar-link">egg中cookie与Session的使用笔记</a></li><li><a href="/docs/article/Node/koa-bodyparser中间件.html" class="sidebar-link">koa-bodyparser中间件</a></li><li><a href="/docs/article/Node/koa-multer实现文件上传并自定义文件名和目录.html" class="sidebar-link">koa-multer实现文件上传并自定义文件名和目录</a></li><li><a href="/docs/article/Node/Make命令教程.html" class="sidebar-link">Make命令教程</a></li><li><a href="/docs/article/Node/Moment进入维护状态.html" class="sidebar-link">Moment 进入维护状态</a></li><li><a href="/docs/article/Node/node版本管理工具.html" class="sidebar-link">node版本管理工具</a></li><li><a href="/docs/article/Node/Node原生模块整理.html" class="sidebar-link">Koa深入学习笔记一</a></li><li><a href="/docs/article/Node/npm安装包时的几个命令区别.html" class="sidebar-link">npm安装包时的几个命令区别</a></li><li><a href="/docs/article/Node/AJV与JSON模式验证.html" class="sidebar-link">npm库：AJV，JSON模式验证</a></li><li><a href="/docs/article/Node/npm依赖管理之peerDependencies.html" class="sidebar-link">npm 依赖管理之 peerDependencies</a></li><li><a href="/docs/article/Node/package.json中的workspaces.html" class="sidebar-link">package.json中的workspaces</a></li><li><a href="/docs/article/Node/pm2的cluster模式与fork模式的区别.html" class="sidebar-link">pm2的cluster模式与fork模式的区别</a></li><li><a href="/docs/article/Node/pm2深入学习.html" class="sidebar-link">pm2深入学习</a></li><li><a href="/docs/article/Node/VScode调试Egg.html" class="sidebar-link">VScode调试Egg</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CI/CD</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux应用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="如何发布一个npm包"><a href="#如何发布一个npm包" class="header-anchor">#</a> 如何发布一个npm包</h1> <p><a href="https://zhuanlan.zhihu.com/p/29204311" target="_blank" rel="noopener noreferrer">转载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>开始之前确保本机nodejs已经安装，检查</p> <div class="language- extra-class"><pre class="language-text"><code>node -v
</code></pre></div><p>有输出版本号，说明已安装
首先在<a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer">npm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>网站上注册一个账号，这个账号会在之后用到</p> <h2 id="pixiv-login"><a href="#pixiv-login" class="header-anchor">#</a> pixiv-login</h2> <p>pixiv-login的功能就是模拟用户登陆网站pixiv，获取cookie，安装
<a href="https://github.com/CoCoyh/npm-test" target="_blank" rel="noopener noreferrer">源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save pixiv-login
</code></pre></div><p>使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pixivLogin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pixiv-login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">pixivLogin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    username<span class="token operator">:</span> <span class="token string">'你的用户名'</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token string">'你的密码'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cookie</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="开发工具"><a href="#开发工具" class="header-anchor">#</a> 开发工具</h2> <p>Mac平台 使用的vscode</p> <h2 id="初始化项目"><a href="#初始化项目" class="header-anchor">#</a> 初始化项目</h2> <div class="language- extra-class"><pre class="language-text"><code>mkdir npm-test
cd npm-test
npm init
</code></pre></div><p>一路回车就好</p> <h2 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h2> <p>要模拟登陆，我们就需要一个http库，这里我选择了<a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer">axios<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，同时获取的html字符串我们需要解析，<a href="https://github.com/cheeriojs/cheerio" target="_blank" rel="noopener noreferrer">cheerio<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>就是首选了</p> <div class="language- extra-class"><pre class="language-text"><code>npm i axios cheerio --save
</code></pre></div><p>现在便携index.js文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://www.pixiv.net'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">debugger</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="正式开始"><a href="#正式开始" class="header-anchor">#</a> 正式开始</h1> <p>虽然我们最后是要写一个npm包，但是首先，我们先把获取cookie的功能实现了，然后再思考怎么封装一个npm包，供其他人使用。</p> <p>进入<a href="https://www.pixiv.net/" target="_blank" rel="noopener noreferrer">登陆页面<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，我们先登陆一次，看看前端向后端发送了那些数据。</p> <p><img src="https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-21-v2-a0cab64f76e3bae3ee485f9b78c477e2_r.jpg" alt="loginhtml.png"></p> <p>这里需要注意的是，我们要勾选<strong>preserve log</strong>，这样，即使页面刷新跳转了，http请求记录仍然回记录下来</p> <p><img src="https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-21-v2-cd50d59bb9c3d53524ef7c445c7925d6_r.jpg" alt="prelogin.png"></p> <p><img src="https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-21-v2-80f7c3c346aff774a7f4809af1474cd6_hd.png" alt="prelogin1.png"></p> <p><img src="https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-21-v2-1dc91ae74dc3bec22d4144b407c4514d_hd.png" alt="prelogin2.png"></p> <p>可以看到，<strong>post_key</strong>是登陆的关键点，p站使用了该值来防止CSRF</p> <p>post_key怎么获取呢？</p> <p>经过页面分析，发现登陆页面，有个隐藏的表单域（后来发现，其实首页就已经写出来了）</p> <p><img src="https://upload-images.jianshu.io/upload_images/9403248-2cd2255b67f3f6c8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="login.jpg"></p> <p>可以清除看到，post_key已经写出来了，我们只需要用cheerio解析出该input的值就OK了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> post_key <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'input[name=&quot;post_key&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>获取post_key</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">LOGIN_URL</span> <span class="token operator">=</span> <span class="token string">'https://accounts.pixiv.net/login?lang=zh&amp;source=pc&amp;view_type=page&amp;ref=wwwtop_accounts_index'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">USER_AGENT</span> <span class="token operator">=</span> <span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">LOGIN_API</span> <span class="token operator">=</span> <span class="token string">'https://accounts.pixiv.net/api/login?lang=zh'</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> getKey <span class="token operator">=</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token constant">LOGIN_URL</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'User-Agent'</span><span class="token operator">:</span> <span class="token constant">USER_AGENT</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> post_key <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'input[name=&quot;post_key&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cookie <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'set-cookie'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'; '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>post_key <span class="token operator">&amp;&amp;</span> cookie<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> post_key<span class="token punctuation">,</span> cookie <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;no post_key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


getKey<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> post_key<span class="token punctuation">,</span> cookie <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">debugger</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>注意：打开注册页时，注册页会返回一些cookie，这些cookie在登陆时也是需要随密码，用户名一起发送过去的</p> <p>获取到了post_key，cookie，我们就可以愉快的把登陆数据发送给后台接口了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
getKey<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> post_key<span class="token punctuation">,</span> cookie <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token constant">LOGIN_API</span><span class="token punctuation">,</span>
        headers<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'User-Agent'</span><span class="token operator">:</span> <span class="token constant">USER_AGENT</span><span class="token punctuation">,</span>
            <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded; charset=UTF-8'</span><span class="token punctuation">,</span>
            <span class="token string">'Origin'</span><span class="token operator">:</span> <span class="token string">'https://accounts.pixiv.net'</span><span class="token punctuation">,</span>
            <span class="token string">'Referer'</span><span class="token operator">:</span> <span class="token string">'https://accounts.pixiv.net/login?lang=zh&amp;source=pc&amp;view_type=page&amp;ref=wwwtop_accounts_index'</span><span class="token punctuation">,</span>
            <span class="token string">'X-Requested-With'</span><span class="token operator">:</span> <span class="token string">'XMLHttpRequest'</span><span class="token punctuation">,</span>
            <span class="token string">'Cookie'</span><span class="token operator">:</span> cookie
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            pixiv_id<span class="token operator">:</span> <span class="token string">'你的用户名'</span><span class="token punctuation">,</span>
            password<span class="token operator">:</span> <span class="token string">'你的密码'</span><span class="token punctuation">,</span>
            captcha<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            g_recaptcha_response<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            post_key<span class="token operator">:</span> post_key<span class="token punctuation">,</span>
            source<span class="token operator">:</span> <span class="token string">'pc'</span><span class="token punctuation">,</span>
            ref<span class="token operator">:</span> <span class="token string">'wwwtop_accounts_index'</span><span class="token punctuation">,</span>
            return_to<span class="token operator">:</span> <span class="token string">'http://www.pixiv.net/'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'set-cookie'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> cookie <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'set-cookie'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' ;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">debugger</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;no cookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意其中这段代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>data<span class="token operator">:</span> querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      pixiv_id<span class="token operator">:</span> <span class="token string">'你的用户名'</span><span class="token punctuation">,</span>
      password<span class="token operator">:</span> <span class="token string">'你的密码'</span><span class="token punctuation">,</span>
      captcha<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      g_recaptcha_response<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      post_key<span class="token operator">:</span> post_key<span class="token punctuation">,</span>
      source<span class="token operator">:</span> <span class="token string">'pc'</span><span class="token punctuation">,</span>
      ref<span class="token operator">:</span> <span class="token string">'wwwtop_accounts_index'</span><span class="token punctuation">,</span>
      return_to<span class="token operator">:</span> <span class="token string">'http://www.pixiv.net/'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>注意：axios默认数据格式是json，如果你想发送<strong>application/x-www-form-urlencoded</strong>的数据，就需要使用<strong>querystring模块</strong></p> <p>如果一切正常，那么效果如下：</p> <p><img src="https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-21-v2-6acb3953cd13d6ae3404a7951f002c25_hd.png" alt="loginres.png"></p> <p>其中，的PHPESSID和device_token就是服务器端返回的登陆标识，说明我们登陆成功了
程序运行的同时，你也很可能收到P站的登陆邮件
好了，目前为止，我们已经成功获取到了cookie，实现了最基本的功能</p> <h1 id="特别注意"><a href="#特别注意" class="header-anchor">#</a> 特别注意</h1> <p>程序不要运行太多次，因为每次运行，你就登陆一次P站，如果被P栈监测到频繁登陆，它会开启验证码登陆模式，这时，你除了需要发送用户名和密码，还需要向后台发送验证码值</p> <div class="language-js extra-class"><pre class="language-js"><code>data<span class="token operator">:</span> querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          pixiv_id<span class="token operator">:</span> <span class="token string">'你的用户名'</span><span class="token punctuation">,</span>
          password<span class="token operator">:</span> <span class="token string">'你的密码'</span><span class="token punctuation">,</span>
          captcha<span class="token operator">:</span> <span class="token string">'你还需要填验证码'</span><span class="token punctuation">,</span>
          g_recaptcha_response<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          post_key<span class="token operator">:</span> post_key<span class="token punctuation">,</span>
          source<span class="token operator">:</span> <span class="token string">'pc'</span><span class="token punctuation">,</span>
          ref<span class="token operator">:</span> <span class="token string">'wwwtop_accounts_index'</span><span class="token punctuation">,</span>
          return_to<span class="token operator">:</span> <span class="token string">'http://www.pixiv.net/'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>也就是，<strong>captcha</strong>字段不再是空值了！</p> <p>基本功能的完整代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">LOGIN_URL</span> <span class="token operator">=</span> <span class="token string">'https://accounts.pixiv.net/login?lang=zh&amp;source=pc&amp;view_type=page&amp;ref=wwwtop_accounts_index'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">USER_AGENT</span> <span class="token operator">=</span> <span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">LOGIN_API</span> <span class="token operator">=</span> <span class="token string">'https://accounts.pixiv.net/api/login?lang=zh'</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> getKey <span class="token operator">=</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token constant">LOGIN_URL</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'User-Agent'</span><span class="token operator">:</span> <span class="token constant">USER_AGENT</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> post_key <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'input[name=&quot;post_key&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cookie <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'set-cookie'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'; '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>post_key <span class="token operator">&amp;&amp;</span> cookie<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> post_key<span class="token punctuation">,</span> cookie <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;no post_key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


getKey<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> post_key<span class="token punctuation">,</span> cookie <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token constant">LOGIN_API</span><span class="token punctuation">,</span>
        headers<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'User-Agent'</span><span class="token operator">:</span> <span class="token constant">USER_AGENT</span><span class="token punctuation">,</span>
            <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded; charset=UTF-8'</span><span class="token punctuation">,</span>
            <span class="token string">'Origin'</span><span class="token operator">:</span> <span class="token string">'https://accounts.pixiv.net'</span><span class="token punctuation">,</span>
            <span class="token string">'Referer'</span><span class="token operator">:</span> <span class="token string">'https://accounts.pixiv.net/login?lang=zh&amp;source=pc&amp;view_type=page&amp;ref=wwwtop_accounts_index'</span><span class="token punctuation">,</span>
            <span class="token string">'X-Requested-With'</span><span class="token operator">:</span> <span class="token string">'XMLHttpRequest'</span><span class="token punctuation">,</span>
            <span class="token string">'Cookie'</span><span class="token operator">:</span> cookie
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            pixiv_id<span class="token operator">:</span> <span class="token string">'你的用户名'</span><span class="token punctuation">,</span>
            password<span class="token operator">:</span> <span class="token string">'你的密码'</span><span class="token punctuation">,</span>
            captcha<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            g_recaptcha_response<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            post_key<span class="token operator">:</span> post_key<span class="token punctuation">,</span>
            source<span class="token operator">:</span> <span class="token string">'pc'</span><span class="token punctuation">,</span>
            ref<span class="token operator">:</span> <span class="token string">'wwwtop_accounts_index'</span><span class="token punctuation">,</span>
            return_to<span class="token operator">:</span> <span class="token string">'http://www.pixiv.net/'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'set-cookie'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> cookie <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'set-cookie'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' ;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;no cookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>封装成一个npm包</p> <p>登陆P站获取cookie这个功能，如果我们想让其他开发者也能方便调用，就可以考虑其封装为一个npm包发布出去</p> <p>目录结构：
<img src="https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-21-v2-29429f58d8c565af4e1433911e9b8d25_hd.png" alt="workspace.png"></p> <h1 id="发布npm包"><a href="#发布npm包" class="header-anchor">#</a> 发布npm包</h1> <h2 id="readme-md"><a href="#readme-md" class="header-anchor">#</a> README.md</h2> <p>每个npm包，一般都需要配一段介绍文字，来告诉使用者如何安装使用，比如lodash的首页
新建一个README.md，填写相关信息
<img src="https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-21-v2-b32b622ecb8238869bd4f8fbca533f9a_hd.png" alt="npm -readme"></p> <p>有时，我们会看到一些npm包有很漂亮的版本号图标：</p> <p><img src="https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-21-v2-a16823a30204c619b171f84d4958894f_hd.png" alt="npml-label.png"></p> <p>这些图标<a href="https://shields.io/" target="_blank" rel="noopener noreferrer">shieds<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上制作
登陆该网站，下拉到最下面</p> <p><img src="https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-21-v2-e23fda34b8937ed3b606ac8dda4789bc_hd.jpg" alt="label1.jpg"></p> <p>输入你想要的文字，版本号，颜色，然后点击按钮</p> <p><img src="https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-21-v2-7d4fab4310d8690f676d51683a01a9e5_hd%20-1-.jpg" alt="label2.jpg"></p> <p>就可以得到图片的访问地址了</p> <p><img src="https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-21-v2-0e18ad152f419c403101af1b501a35b3_hd.png" alt="label3.png"></p> <p>修改刚才的README.md，加上我们的版本号</p> <h2 id="gitignore"><a href="#gitignore" class="header-anchor">#</a> .gitignore</h2> <p>node_modules以及.vscode是完全不用上传的，所以为了防止发布时带上这些文件夹，我们要新建一个.gitignore</p> <div class="language- extra-class"><pre class="language-text"><code>.vscode/
node_modules/
</code></pre></div><h1 id="包发布"><a href="#包发布" class="header-anchor">#</a> 包发布</h1> <p>在终端输入</p> <div class="language- extra-class"><pre class="language-text"><code>npm adduser
</code></pre></div><p>输入用户名，密码，邮箱即可登陆成功</p> <p><strong>这里还有一个坑！</strong></p> <p>如果你的npm使用的是淘宝镜像，那么是无法登陆成功的</p> <p>最简单的解决方法：</p> <div class="language- extra-class"><pre class="language-text"><code>npm i nrm -g
nrm use npm
</code></pre></div><p>nrm是个npm镜像管理工具，可以很方便的切换镜像源</p> <p>登陆成功后，输入</p> <div class="language- extra-class"><pre class="language-text"><code>npm whoami
</code></pre></div><p>如果出现了你的用户名，说明你已经成功登陆了</p> <p>特别</p> <p>因为包名字唯一，否则发布不了</p> <p>修改pacakge.json文件的name字段</p> <p>npm publish
即可发布成功啦！</p> <h1 id="更新已发布的包"><a href="#更新已发布的包" class="header-anchor">#</a> 更新已发布的包</h1> <p>更新包和发布包的命令是一样的，更新包只需修改package.json里面的<code>version</code>字段,也可以使用npm自带的版本控制命令修改版本号，更新的步骤为</p> <ol><li>修改版本号</li> <li>npm publish</li></ol> <h2 id="npm-version"><a href="#npm-version" class="header-anchor">#</a> npm version</h2> <p>npm 官方提供了<code>npm version</code>来进行版本控制，其效果跟手动修改<code>package.json</code>里面的<code>version</code>字段是一样的，好处在于，可以在构建过程中用命令自动修改，而且具有语义化即<code>Semantic versioning</code></p> <div class="language- extra-class"><pre class="language-text"><code>npm version [&lt;newversion&gt; | major | minor | patch | premajor | preminor |
prepatch | prerelease | from-git]
</code></pre></div><p>其语义为：</p> <div class="language- extra-class"><pre class="language-text"><code>major：主版本号（大版本）
minor：次版本号（小更新）
patch：补丁号（补丁）
premajor：预备主版本
preminor: 预备次版本
prepatch：预备补丁版本
prerelease：预发布版本
</code></pre></div><p>如初始版本为1.0.0，执行相关类型命令后，对应的语义为：</p> <div class="language- extra-class"><pre class="language-text"><code>npm version patch  // 1.0.1 表示小的bug修复
npm version minor // 1.1.0 表示新增一些小功能
npm version mmajor // 2.0.0 表示大的版本或大升级
npm version preminor // 1.1.0-0 后面多了个0，表示预发布
</code></pre></div><p>可以在当前模块的<code>package.json</code>里面看到相应的版本变化</p> <h1 id="撤销发布"><a href="#撤销发布" class="header-anchor">#</a> 撤销发布</h1> <p>由于撤销发布会让把要撤销的包作为依赖的包不能正常工作，所以npm官方对包的撤销是有限制的：</p> <ol><li>不允许撤销发布已经超过24小时的包</li> <li>如果在24小时内确实要撤销，需要<code>--force</code>参数</li> <li>即使撤销了发布的包，再次发布的时候也不能与之前被撤销的包的名称/版本其中之一相同，因为这两者构成的唯一性已经被占用，官方并没有随着测笑而删除</li></ol> <h2 id="npm-publish"><a href="#npm-publish" class="header-anchor">#</a> npm publish</h2> <p>撤销发布的命令为 npm unpublish</p> <div class="language- extra-class"><pre class="language-text"><code>npm unpublish my-test-project
// 报错
npm ERR! Refusing to delete entire project.
npm ERR! Run with --force to do this.
npm ERR! npm unpublish [&lt;@scope&gt;/]&lt;pkg&gt;[@&lt;version&gt;]

// 加 --force参数重新撤销发布
npm unpublish my-test-project --force
npm WARN using --force I sure hope you know what you are doing.
- my-test-project

</code></pre></div><h2 id="npm-deprecate"><a href="#npm-deprecate" class="header-anchor">#</a> npm deprecate</h2> <p>npm unpublish的推荐替代命令：</p> <div class="language- extra-class"><pre class="language-text"><code>npm deprecate &lt;pkg&gt;[@&lt;version&gt;] &lt;message&gt;
</code></pre></div><p>这个命令，并不会在npm上里撤销已有的包，但会在任何人尝试安装这个包的时候得到deprecated的警告，例如：</p> <div class="language- extra-class"><pre class="language-text"><code>npm deprecate my-test-project 'this package is no longer maintained'
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/24/2021, 9:19:52 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/article/Node/如何保存价值上千万的Node源代码.html" class="prev">
        如何保存价值上千万的Node源代码
      </a></span> <span class="next"><a href="/docs/article/Node/如何解决npm-unmet-peer-dependency.html">
        如何解决 npm unmet peer dependency
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.46096340.js" defer></script><script src="/docs/assets/js/2.7017696c.js" defer></script><script src="/docs/assets/js/94.c1380c2b.js" defer></script>
  </body>
</html>
