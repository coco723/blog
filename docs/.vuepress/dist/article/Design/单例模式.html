<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>单例模式 | 郭雁宏的博客</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="知识图谱">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.5ae08d27.js" as="script"><link rel="preload" href="/assets/js/2.7017696c.js" as="script"><link rel="preload" href="/assets/js/45.4b1d2214.js" as="script"><link rel="prefetch" href="/assets/js/10.dbbc947c.js"><link rel="prefetch" href="/assets/js/100.8100dcab.js"><link rel="prefetch" href="/assets/js/101.c9b39db2.js"><link rel="prefetch" href="/assets/js/102.9653b591.js"><link rel="prefetch" href="/assets/js/103.95d44d5c.js"><link rel="prefetch" href="/assets/js/104.d7c639f3.js"><link rel="prefetch" href="/assets/js/105.4f558cf9.js"><link rel="prefetch" href="/assets/js/106.d141d887.js"><link rel="prefetch" href="/assets/js/107.3c8258c7.js"><link rel="prefetch" href="/assets/js/108.ce8b4d17.js"><link rel="prefetch" href="/assets/js/109.5ee30361.js"><link rel="prefetch" href="/assets/js/11.28c0f572.js"><link rel="prefetch" href="/assets/js/110.d0f9fac3.js"><link rel="prefetch" href="/assets/js/111.89abc2ca.js"><link rel="prefetch" href="/assets/js/112.044c5c04.js"><link rel="prefetch" href="/assets/js/113.50e827e8.js"><link rel="prefetch" href="/assets/js/114.5149d808.js"><link rel="prefetch" href="/assets/js/115.73cdf02e.js"><link rel="prefetch" href="/assets/js/116.45b81c0c.js"><link rel="prefetch" href="/assets/js/117.18f43ef3.js"><link rel="prefetch" href="/assets/js/118.08112ee7.js"><link rel="prefetch" href="/assets/js/119.ed45d50a.js"><link rel="prefetch" href="/assets/js/12.b3f54211.js"><link rel="prefetch" href="/assets/js/120.2afa9f6d.js"><link rel="prefetch" href="/assets/js/121.7cd22d3b.js"><link rel="prefetch" href="/assets/js/122.45454cf6.js"><link rel="prefetch" href="/assets/js/123.579fc55d.js"><link rel="prefetch" href="/assets/js/124.1d6e8d90.js"><link rel="prefetch" href="/assets/js/125.99db7877.js"><link rel="prefetch" href="/assets/js/126.616d92eb.js"><link rel="prefetch" href="/assets/js/127.84f01aff.js"><link rel="prefetch" href="/assets/js/128.0e73b0ac.js"><link rel="prefetch" href="/assets/js/129.8a582252.js"><link rel="prefetch" href="/assets/js/13.8acebbba.js"><link rel="prefetch" href="/assets/js/130.c5cccb2b.js"><link rel="prefetch" href="/assets/js/131.9bf87216.js"><link rel="prefetch" href="/assets/js/132.5ba46002.js"><link rel="prefetch" href="/assets/js/133.c319a1c5.js"><link rel="prefetch" href="/assets/js/134.918a3458.js"><link rel="prefetch" href="/assets/js/135.9566dd86.js"><link rel="prefetch" href="/assets/js/136.6bff8f44.js"><link rel="prefetch" href="/assets/js/137.727cf25d.js"><link rel="prefetch" href="/assets/js/138.a03900a7.js"><link rel="prefetch" href="/assets/js/139.c765bc43.js"><link rel="prefetch" href="/assets/js/14.ac229abc.js"><link rel="prefetch" href="/assets/js/140.6eebddfa.js"><link rel="prefetch" href="/assets/js/141.19fc2744.js"><link rel="prefetch" href="/assets/js/142.ce56fbcd.js"><link rel="prefetch" href="/assets/js/143.68d57f9e.js"><link rel="prefetch" href="/assets/js/144.3ce571aa.js"><link rel="prefetch" href="/assets/js/145.f765e124.js"><link rel="prefetch" href="/assets/js/146.08f4f3f2.js"><link rel="prefetch" href="/assets/js/147.49b9348e.js"><link rel="prefetch" href="/assets/js/148.9e45c543.js"><link rel="prefetch" href="/assets/js/149.e4906431.js"><link rel="prefetch" href="/assets/js/15.1d8df517.js"><link rel="prefetch" href="/assets/js/150.78d83577.js"><link rel="prefetch" href="/assets/js/151.b534bea5.js"><link rel="prefetch" href="/assets/js/152.9ac48b08.js"><link rel="prefetch" href="/assets/js/153.dee58983.js"><link rel="prefetch" href="/assets/js/154.3ab18289.js"><link rel="prefetch" href="/assets/js/155.482c1692.js"><link rel="prefetch" href="/assets/js/156.d390eced.js"><link rel="prefetch" href="/assets/js/157.b2e71824.js"><link rel="prefetch" href="/assets/js/158.4ffabe12.js"><link rel="prefetch" href="/assets/js/159.c6a45bb7.js"><link rel="prefetch" href="/assets/js/16.9762142f.js"><link rel="prefetch" href="/assets/js/17.9527d288.js"><link rel="prefetch" href="/assets/js/18.0ffcad20.js"><link rel="prefetch" href="/assets/js/19.d4ca4fe9.js"><link rel="prefetch" href="/assets/js/20.ec316bbf.js"><link rel="prefetch" href="/assets/js/21.047b8259.js"><link rel="prefetch" href="/assets/js/22.a0a3de8b.js"><link rel="prefetch" href="/assets/js/23.9e540fc0.js"><link rel="prefetch" href="/assets/js/24.304a86c1.js"><link rel="prefetch" href="/assets/js/25.f8221fc9.js"><link rel="prefetch" href="/assets/js/26.e7ca1908.js"><link rel="prefetch" href="/assets/js/27.2bf1b626.js"><link rel="prefetch" href="/assets/js/28.ede261f3.js"><link rel="prefetch" href="/assets/js/29.7670cd57.js"><link rel="prefetch" href="/assets/js/3.9ed1609e.js"><link rel="prefetch" href="/assets/js/30.86251abf.js"><link rel="prefetch" href="/assets/js/31.7f7dcee0.js"><link rel="prefetch" href="/assets/js/32.a4fb2f9b.js"><link rel="prefetch" href="/assets/js/33.7af93341.js"><link rel="prefetch" href="/assets/js/34.463bd507.js"><link rel="prefetch" href="/assets/js/35.6f39c642.js"><link rel="prefetch" href="/assets/js/36.d216d3e1.js"><link rel="prefetch" href="/assets/js/37.2dd1c63a.js"><link rel="prefetch" href="/assets/js/38.2d2c73b1.js"><link rel="prefetch" href="/assets/js/39.2bcca1e5.js"><link rel="prefetch" href="/assets/js/4.2b93dc1f.js"><link rel="prefetch" href="/assets/js/40.30e1b071.js"><link rel="prefetch" href="/assets/js/41.24ef8a1d.js"><link rel="prefetch" href="/assets/js/42.77eae790.js"><link rel="prefetch" href="/assets/js/43.313a810d.js"><link rel="prefetch" href="/assets/js/44.072e7524.js"><link rel="prefetch" href="/assets/js/46.80d02270.js"><link rel="prefetch" href="/assets/js/47.a382f1e0.js"><link rel="prefetch" href="/assets/js/48.c8bc14ce.js"><link rel="prefetch" href="/assets/js/49.1bc462c5.js"><link rel="prefetch" href="/assets/js/5.f064699d.js"><link rel="prefetch" href="/assets/js/50.527edf7a.js"><link rel="prefetch" href="/assets/js/51.7cd40a77.js"><link rel="prefetch" href="/assets/js/52.30b66adf.js"><link rel="prefetch" href="/assets/js/53.f415b2c1.js"><link rel="prefetch" href="/assets/js/54.1931bbb5.js"><link rel="prefetch" href="/assets/js/55.43517470.js"><link rel="prefetch" href="/assets/js/56.e291ab1f.js"><link rel="prefetch" href="/assets/js/57.1ed58543.js"><link rel="prefetch" href="/assets/js/58.225fe1dd.js"><link rel="prefetch" href="/assets/js/59.52906469.js"><link rel="prefetch" href="/assets/js/6.258c7694.js"><link rel="prefetch" href="/assets/js/60.ed5a0ff8.js"><link rel="prefetch" href="/assets/js/61.5d271aa8.js"><link rel="prefetch" href="/assets/js/62.ec91fd06.js"><link rel="prefetch" href="/assets/js/63.bfd6f06f.js"><link rel="prefetch" href="/assets/js/64.910fd082.js"><link rel="prefetch" href="/assets/js/65.509a4881.js"><link rel="prefetch" href="/assets/js/66.61c96488.js"><link rel="prefetch" href="/assets/js/67.6e4bc734.js"><link rel="prefetch" href="/assets/js/68.553f2c6e.js"><link rel="prefetch" href="/assets/js/69.6bd84ec5.js"><link rel="prefetch" href="/assets/js/7.8ce283fe.js"><link rel="prefetch" href="/assets/js/70.b10f5d9f.js"><link rel="prefetch" href="/assets/js/71.7054ce09.js"><link rel="prefetch" href="/assets/js/72.8fe88334.js"><link rel="prefetch" href="/assets/js/73.a2b03877.js"><link rel="prefetch" href="/assets/js/74.df5d6f2d.js"><link rel="prefetch" href="/assets/js/75.751714e7.js"><link rel="prefetch" href="/assets/js/76.54bab402.js"><link rel="prefetch" href="/assets/js/77.b6ce7fbd.js"><link rel="prefetch" href="/assets/js/78.69d8ae90.js"><link rel="prefetch" href="/assets/js/79.a1a1cbbf.js"><link rel="prefetch" href="/assets/js/8.a6492f22.js"><link rel="prefetch" href="/assets/js/80.a313433c.js"><link rel="prefetch" href="/assets/js/81.c1e03734.js"><link rel="prefetch" href="/assets/js/82.06e0982a.js"><link rel="prefetch" href="/assets/js/83.ecc12371.js"><link rel="prefetch" href="/assets/js/84.b29bce86.js"><link rel="prefetch" href="/assets/js/85.8110173f.js"><link rel="prefetch" href="/assets/js/86.87b0a706.js"><link rel="prefetch" href="/assets/js/87.0178a828.js"><link rel="prefetch" href="/assets/js/88.eb125c41.js"><link rel="prefetch" href="/assets/js/89.2d071390.js"><link rel="prefetch" href="/assets/js/9.0d5c9d6d.js"><link rel="prefetch" href="/assets/js/90.0d6e7903.js"><link rel="prefetch" href="/assets/js/91.d4eca2fa.js"><link rel="prefetch" href="/assets/js/92.a2b1188f.js"><link rel="prefetch" href="/assets/js/93.c29b471b.js"><link rel="prefetch" href="/assets/js/94.c1380c2b.js"><link rel="prefetch" href="/assets/js/95.a04cdc1a.js"><link rel="prefetch" href="/assets/js/96.71b9568b.js"><link rel="prefetch" href="/assets/js/97.e4616dac.js"><link rel="prefetch" href="/assets/js/98.5ce0acee.js"><link rel="prefetch" href="/assets/js/99.4ad355d7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">郭雁宏的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/article/" class="nav-link router-link-active">
  文章目录
</a></div><div class="nav-item"><a href="/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="https://github.com/coco723/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/article/" class="nav-link router-link-active">
  文章目录
</a></div><div class="nav-item"><a href="/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="https://github.com/coco723/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/article/" aria-current="page" class="sidebar-link">文章目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>图表</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器和网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>样式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node实践</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CI/CD</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux应用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>设计模式</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/article/Design/单例模式.html" class="active sidebar-link">单例模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/Design/单例模式.html#单例" class="sidebar-link">单例</a></li><li class="sidebar-sub-header"><a href="/article/Design/单例模式.html#使用new" class="sidebar-link">使用new</a></li><li class="sidebar-sub-header"><a href="/article/Design/单例模式.html#将实例放到静态属性中" class="sidebar-link">将实例放到静态属性中</a></li><li class="sidebar-sub-header"><a href="/article/Design/单例模式.html#将实例放到闭包中" class="sidebar-link">将实例放到闭包中</a></li></ul></li><li><a href="/article/Design/工厂模式.html" class="sidebar-link">工厂模式</a></li><li><a href="/article/Design/迭代器模式.html" class="sidebar-link">迭代器模式</a></li><li><a href="/article/Design/装饰器模式.html" class="sidebar-link">装饰器模式</a></li><li><a href="/article/Design/策略模式.html" class="sidebar-link">策略模式</a></li><li><a href="/article/Design/外观模式.html" class="sidebar-link">外观模式</a></li><li><a href="/article/Design/代理模式.html" class="sidebar-link">代理模式</a></li><li><a href="/article/Design/中介者模式.html" class="sidebar-link">中介者模式</a></li><li><a href="/article/Design/观察者模式.html" class="sidebar-link">观察者模式</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="单例模式"><a href="#单例模式" class="header-anchor">#</a> 单例模式</h1> <p>在GoF（Gang of Four）的书中提出的设计模式为面向对象的软件设计中遇到的一些普遍问题提供了解决方案。它们已经诞生很久了，而且被证实在很多情况下是很有效的。这正是你需要熟悉它的原因，也是我们要讨它的原因。</p> <p>尽管这些设计模式跟语言和具体的实现方式无关，但他们多年来被关注到的方面仍然主要是强类型静态语言比如C++和Java中的应用。</p> <p>JavaScript作为一种基于原型的弱类型动态语言，是的有些时候实现某些模式时相当简单，甚至不菲吹灰之力。</p> <p>让我们从第一个例子--单例模式--来看一下在JavaScript中和静态的基于类的语言有什么不同。</p> <h2 id="单例"><a href="#单例" class="header-anchor">#</a> 单例</h2> <p>单例模式的核心思想是让指定的类只存在 唯一一个实例。这意味着当你第二次 使用相同的类的去创建对象的时候，你得到的应该和第一次创建的是同一个对象。</p> <p>这如何应用到JavaScript中呢？在JavaScript中没有类，只有对象。当你创建一个对象时，事实上根本没有另一个对象和它一样，这个对象其实已经是一个单例。使用对象字面量创建一个简单的对象也是一种单例的例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span>  obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  myprop<span class="token operator">:</span> <span class="token string">'my value'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在JavaScript中，对象永远不会相等，除非它们是同一个对象，所以即使你创建一个看起来完全一样的对象，它也不会和前面的对象相等：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  myprop<span class="token operator">:</span> <span class="token string">'my value'</span>
<span class="token punctuation">}</span>

obj <span class="token operator">===</span> obj2<span class="token punctuation">;</span> <span class="token comment">// false</span>
obj <span class="token operator">==</span> obj2<span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><p>所以你可以说当你每次使用对象字面量创建一个对象的时候就是在创建 一个单例，并没有特别的预发牵涉进来。</p> <p>需要注意的是，有的时候当人们在JavaScript中提出“单例”的时候，它们可能是指第五章讨论的“模块模式”。</p> <h2 id="使用new"><a href="#使用new" class="header-anchor">#</a> 使用new</h2> <p>JavaScript没有类，所以一字一句地说单例的定义并没有什么意义。但是 JavaScript有使用new、通过构造函数来创建对象的语法，有时候你可能需要这种语法下的一个单例实现。这也就是说当你使用new、通过同一个构造函数来创建多个对象的时候，你应该只是得到同一个对象的不同引用。</p> <p>温馨提示：从一个使用模式的角度来说，下面的讨论并不是那么有用，只是更多地在实践模拟一些语言中关于这个模式的一些问题的解决方案。这些语言主要是（静态强类型的）基于类的语言，在这些语言汇总，函数并不是“一等公民”。</p> <p>下面的代码片段展示了期望的结果（假设你忽略了多元宇宙的设想，接受了只有一个宇宙的观点）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> uni <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> uni2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
uni <span class="token operator">===</span> uni2<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>在这个例子中，uni只在构造函数第一次被调用时创建。第二次（以及后续更多次）调用时，同一个uni对象被返回。这就是为什么uni === uni2的原因--因为它们实际上是同一个对象的两个引用。那么怎么在JavaScript达到这个效果呢？</p> <p>当对象实例this被创建时，你需要在Universe构造函数中缓存它，以便在第二次调用的时候返回。有几种选择可以达到这种效果：</p> <ul><li><p>你可以使用一个全局变量来存储实例。不推荐使用这种方法，因为通常我们认为是易用全局变量是不好的。而且，任何人都可以改写全局变量的值，甚至可能是无意中改写。所以我们不再讨论这种方案。</p></li> <li><p>你也可以将对象实例缓存在构造函数的属性中。在JavaScript中，函数也是对象，所以它们也可以有属性。你可以写一些类似Universe。instance的属性来缓存对象。这是一种漂亮干净的解决方案，不足之处是instance属性仍然是可以被公开访问的，别人写代码可能修改它，这样就会失去这个实例。</p></li> <li><p>你可以将实例包裹在闭包中。这可以保持实例是私有的，不会在构造函数之外被修改，代价是一个额外的闭包。</p></li></ul> <p>让我们来看一下第二种和第三种方案的实现示例。</p> <h2 id="将实例放到静态属性中"><a href="#将实例放到静态属性中" class="header-anchor">#</a> 将实例放到静态属性中</h2> <p>下面是将唯一的实例放入Universe构造函数的一个静态属性中的例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// do we hanve an existing instance?</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Universe<span class="token punctuation">.</span>instance <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Universe<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// proceed as normal</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>start_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>bang <span class="token operator">=</span> <span class="token string">&quot;Big&quot;</span><span class="token punctuation">;</span>

  <span class="token comment">// cache</span>
  Universe<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token comment">// implicit return;</span>
  <span class="token comment">// return this;</span>
<span class="token punctuation">}</span>

<span class="token comment">// testing</span>
<span class="token keyword">const</span> uni <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> uni2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

uni <span class="token operator">===</span> uni2<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>如你所见，这是一种直接有效的解决方案，唯一的缺陷是instance是可以被公开访问的。一般来说它被其他代码误删改的可能是很小的（起码比全局变量instance要小得多），但是仍然是有可能的。</p> <h2 id="将实例放到闭包中"><a href="#将实例放到闭包中" class="header-anchor">#</a> 将实例放到闭包中</h2> <p>另一种实现基于类的单例模式的方法是使用一个闭包来保护这个唯一的实例。你可以通过第五章讨论过的”私有静态成员模式“来实现。唯一的秘密就是重写构造函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// the chched instance</span>
  <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token comment">// proceed as normal</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>start_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>bang <span class="token operator">=</span> <span class="token string">&quot;Big&quot;</span><span class="token punctuation">;</span>

  <span class="token comment">// rewrite the constructor</span>
  <span class="token function-variable function">Universe</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// testing</span>
<span class="token keyword">const</span> uni <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> uni2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

uni <span class="token operator">===</span> uni2<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>第一次调用时，原始的构造函数被调用并且正常返回this。在后续的调用中，被重写的构造函数被调用。被重写怕这个构造函数可以通过闭包访问私有的instance变量并且将它返回。</p> <p>这个实例实际上也是第四章讨论的自定义函数的又一个例子。如我们讨论过的一样，这种模式的缺点是被重写的函数（在这个例子中就是构造函数<code>Universe（）</code>）将丢失那些在出事定义和重新定义之间添加的属性。在这个例子中，任何添加到<code>Universe()</code>的原型上的属性将不会被链接到使用原来的实现创建的实例上（注：这里的“原来的实现”是指实例是由未被重写的构造函数创建的，而<code>Universe()</code>则是被重写的构造函数。）</p> <p>下面我们通过一些测试来展示这个问题：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// adding to the prototype</span>
<span class="token class-name">Universe</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>noting <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> uni <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// again adding to the prototype</span>
<span class="token comment">// after the initial object is created</span>
<span class="token class-name">Universe</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>everything <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> uni2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// testing</span>
<span class="token comment">// only the original prototype was linkes to the objects</span>
uni<span class="token punctuation">.</span>noting<span class="token punctuation">;</span> <span class="token comment">// true;</span>
uni2<span class="token punctuation">.</span>noting<span class="token punctuation">;</span> <span class="token comment">// true,</span>
uni<span class="token punctuation">.</span>everything<span class="token punctuation">;</span> <span class="token comment">// undefined</span>
uni2<span class="token punctuation">.</span>everything<span class="token punctuation">;</span> <span class="token comment">// undefined</span>

<span class="token comment">// that sounds right:</span>

uni<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// &quot;Universe&quot;</span>

<span class="token comment">// but that's odd:</span>
uni<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Universe<span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><p>uni.constructor不再和Universe（）相同的原因是uni.constructor仍然是指向原来的构造函数，而不是被重新定义的那个。</p> <p>如果一定被要求让prototype和constructor的指向像我们期望的那样，可以通过一些调整来做到：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// the cached instance</span>
  <span class="token keyword">let</span> instance<span class="token punctuation">;</span>

  <span class="token comment">// rewrite the constructor</span>
  <span class="token function-variable function">Universe</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// carry over the prototype properties</span>
  <span class="token class-name">Universe</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token comment">// the instance</span>
  instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// reset the constuctor pointer</span>
  instance<span class="token punctuation">.</span>constuctor <span class="token operator">=</span> Universe<span class="token punctuation">;</span>


  <span class="token comment">// all the functionality</span>
  instance<span class="token punctuation">.</span>start_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span>bang <span class="token operator">=</span> <span class="token string">&quot;Big&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在所有的测试结果都可以像我们期望的那样了：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// update prototype and create instance</span>
<span class="token class-name">Universe</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>noting <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token keyword">const</span> uni <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Universe</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>everything <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

cosnt uni2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// it's the same single instance</span>
uni <span class="token operator">===</span> uni2<span class="token punctuation">;</span>  <span class="token comment">// true</span>

<span class="token comment">// all prototype properties work</span>
<span class="token comment">// no matter when they were defined</span>
uni<span class="token punctuation">.</span>noting <span class="token operator">&amp;&amp;</span> uni<span class="token punctuation">.</span>everything <span class="token operator">&amp;&amp;</span> uni2<span class="token punctuation">.</span>noting <span class="token operator">&amp;&amp;</span> uni2<span class="token punctuation">.</span>everything<span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// the normal properties work uni.bang; // &quot;Big&quot;</span>
<span class="token comment">// the constuctor points correctly</span>
uni<span class="token punctuation">.</span>constuctor <span class="token operator">===</span> Universe<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>另一种可选的解决发难是将构造函数和实例包在一个立即执行的函数中。当构造函数第一次被调用的时候，它返回一个对象并且将私有的instance指向它。在后续调用时，构造函数是指简单地返回这个私有变量。在这种新的实现下，前面所有的测试代码也会和期望的一样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function">Universe</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> instance<span class="token punctuation">;</span>

  <span class="token function-variable function">Universe</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">// all the functionality</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>start_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bang <span class="token operator">=</span> <span class="token string">&quot;Big&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/24/2021, 9:19:52 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/article/Linux/Linux上部署Node服务外网无法访问.html" class="prev">
        Linux上部署Node服务外网无法访问
      </a></span> <span class="next"><a href="/article/Design/工厂模式.html">
        工厂模式
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5ae08d27.js" defer></script><script src="/assets/js/2.7017696c.js" defer></script><script src="/assets/js/45.4b1d2214.js" defer></script>
  </body>
</html>
